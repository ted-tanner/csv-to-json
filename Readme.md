# CSV-to-JSON Converter

A C library for converting text from the CSV format to the JSON format. A Python wrapper is included.

## C Functions

The functions with the following signatures are exposed by the compiled C libraries:

```
// Takes a pointer to a buffer containing the CSV data as well as the length
// of the buffer (in bytes). Returns a buffer containing the formatted
// JSON data.
char* csv_to_json(char* csv, size_t length);

// Takes as an argument the pointer to the buffer containing the JSON data
// generated by the csv_to_json function and frees the associated memory.
// This call is NOT optional and failure to make the call will result in a
// memory leak.
void free_json(void* csv_ptr);
```

## Python Wrapper Function

The Python wrapper exposes a single public function with the following signature:

```
def csv_to_json(csv, as_str=False)
```

The function returns a `str` or `bytes` object depending on whether the optional `as_str` parameter is defined to be `True`. The `csv` parameter expects a `str` or `bytes` object (_not_ dependent on the `as_str` parameter) containing the CSV data.

## Building and Debugging the C Code

The CSV-to-JSON Converter is written in C and gets compiled to a shared dynamic link library. To build the libraries, run the appropriate version of the following command from the directory containing the `.c` and `.h` source files:

### Production Builds

##### macOS x86_64 (`gcc`)
```
gcc -O3 -fPIC -shared -o ../libs/csv-to-json-x86.dylib dynarray.c csvjson.c
```

##### macOS Apple Silicon (`clang`)
```
clang -O3 -fPIC -shared -o ../libs/csv-to-json-arm64.dylib dynarray.c csvjson.c
```

##### Linux (`gcc`)
```
gcc -O3 -fPIC -shared -o ../libs/csv-to-json.so dynarray.c csvjson.c
```

##### Windows (`mingw` from WSL)
```
x86_64-w64-mingw32-gcc -O3 -fPIC -shared -o ../libs/csv-to-json.dll dynarray.c csvjson.c
```

### Debug Builds

##### macOS x86_64 (`gcc`)
```
gcc -DDEBUG -g -Wall -fPIC -shared -o ../libs/csv-to-json-x86.dylib dynarray.c csvjson.c
```

##### macOS Apple Silicon (`clang`)
```
clang -DDEBUG -g -Wall -fPIC -shared -o ../libs/csv-to-json-arm64.dylib dynarray.c csvjson.c
```

##### Linux (`gcc`)
```
gcc -DDEBUG -g -Wall -fPIC -shared -o ../libs/csv-to-json.so dynarray.c csvjson.c
```

##### Windows (`mingw` from WSL)
```
x86_64-w64-mingw32-gcc -DDEBUG -g -Wall -fPIC -shared -o ../libs/csv-to-json.dll dynarray.c csvjson.c
```